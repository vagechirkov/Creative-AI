FROM python:3.9-slim-buster

COPY ./requirements-celery.txt /usr/src/

RUN pip install --upgrade pip

RUN pip install -r /usr/src/requirements-celery.txt

RUN mkdir /usr/src/flower

COPY ./app/celery_worker /usr/src/flower/celery_worker

COPY ./app/__init__.py /usr/src/flower/

COPY ./app/config.py /usr/src/flower/

COPY app/logging_config.py /usr/src/flower/

WORKDIR /usr/src/flower

CMD celery -A celery_worker.tasks flower --broker=redis://${REDIS_HOST}:${REDIS_PORT}/${REDIS_CELERY_DB_INDEX}  --port=${PORT} --basic_auth=${FLOWER_USER}:${FLOWER_PASSWORD}


#FROM mher/flower:0.9.7
#CMD flower -e CELERY_BROKER_URL=redis://${REDIS_HOST}:${REDIS_PORT}/${REDIS_CELERY_DB_INDEX}