FROM python:3.9-slim-buster

COPY ./requirements-celery.txt ./

RUN pip install --upgrade pip

RUN pip install -r requirements-celery.txt

COPY ./app/celery_worker ./celery_worker

COPY ./app/__init__.py ./

COPY ./app/config.py ./

COPY app/logging_config.py ./

COPY ./nginx.conf ./

CMD celery -A celery_worker.tasks flower --broker=redis://${REDIS_HOST}:${REDIS_PORT}/${REDIS_CELERY_DB_INDEX} --port=${PORT} --basic_auth=${FLOWER_USER}:${FLOWER_PASSWORD}
